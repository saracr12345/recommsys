generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  createdAt DateTime @default(now())

  threads              ChatThread[]
  events               RecommendationEvent[]
  savedRecommendations SavedRecommendation[]
}

model ModelProfile {
  id       String  @id
  name     String
  provider String?
  family   String?

  contextWindow   Int?
  latencyMs       Int?
  costPer1kTokens Float?
  apiType         String?

  // stored as JSON array of strings
  domainTags Json @default("[]")

  modality String?
  license  String?

  // NEW: model card fields (JSON arrays)
  pros            Json @default("[]")
  cons            Json @default("[]")
  ragTips         Json @default("[]")
  typicalUseCases Json @default("[]")
  strengths       Json @default("[]")
  limitations     Json @default("[]")

  source String?
  url    String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model RecommendationEvent {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  task    String
  privacy String
  latency Int
  context Int

  results Json

  userId  Int?
  user    User?                 @relation(fields: [userId], references: [id])
  savedBy SavedRecommendation[]
}

model ChatThread {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  title String?

  userId Int
  user   User @relation(fields: [userId], references: [id])

  messages ChatMessage[]
}

model ChatMessage {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  role    String // "user" | "assistant" | "system"
  content String
  model   String?

  threadId Int
  thread   ChatThread @relation(fields: [threadId], references: [id])
}

model SavedRecommendation {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  userId Int
  user   User @relation(fields: [userId], references: [id])

  eventId Int
  event   RecommendationEvent @relation(fields: [eventId], references: [id])

  note String?

  archived Boolean @default(false)

  @@unique([userId, eventId])
}
